[2025-03-20 22:37:45,658] INFO main:192 - ------ Command line arguments -------
[2025-03-20 22:37:45,658] INFO main:193 - step                                              : step05_generate_response
[2025-03-20 22:37:45,658] INFO main:194 - input_filename                                    : None
[2025-03-20 22:37:45,658] INFO main:195 - query_args                                        : Compare the rights in USA Constitution vs. Norway Constitution. Use only the provided context and don't use any outside material at all. Also, dont give me all the steps, just give me one long paragraph.
[2025-03-20 22:37:45,659] INFO main:196 - use_rag                                           : True
[2025-03-20 22:37:45,659] INFO main:197 - ------ Config Settings -------
[2025-03-20 22:37:45,659] INFO main:199 - cleaned_text_directory                            : data/cleaned_text
[2025-03-20 22:37:45,659] INFO main:199 - collection_name                                   : collections
[2025-03-20 22:37:45,659] INFO main:199 - embedding_model_name                              : sentence-transformers/all-MiniLM-L6-v2
[2025-03-20 22:37:45,659] INFO main:199 - embeddings_directory                              : data/embeddings
[2025-03-20 22:37:45,659] INFO main:199 - llm_api_url                                       : http://localhost:1234/v1/completions
[2025-03-20 22:37:45,659] INFO main:199 - llm_model_name                                    : llama-3.2-1b-instruct
[2025-03-20 22:37:45,659] INFO main:199 - log_level                                         : debug
[2025-03-20 22:37:45,659] INFO main:199 - raw_input_directory                               : data/raw_input
[2025-03-20 22:37:45,659] INFO main:199 - retriever_min_score_threshold                     : 0.5
[2025-03-20 22:37:45,659] INFO main:199 - vectordb_directory                                : data/vectordb
[2025-03-20 22:37:45,659] INFO main:200 - ------------------------------
[2025-03-20 22:37:45,659] INFO main:46 - Ensured directory exists: data/raw_input
[2025-03-20 22:37:45,659] INFO main:46 - Ensured directory exists: data/cleaned_text
[2025-03-20 22:37:45,659] INFO main:46 - Ensured directory exists: data/embeddings
[2025-03-20 22:37:45,659] INFO main:46 - Ensured directory exists: data/vectordb
[2025-03-20 22:37:45,659] INFO main:131 - [Step 05] Response generation started.
[2025-03-20 22:37:45,659] INFO llm_client:18 - Initialized LLMClient: llm_api_url: http://localhost:1234/v1/completions, model_name: llama-3.2-1b-instruct
[2025-03-20 22:37:45,685] INFO posthog:22 - Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
[2025-03-20 22:37:45,856] INFO SentenceTransformer:210 - Use pytorch device_name: mps
[2025-03-20 22:37:45,856] INFO SentenceTransformer:218 - Load pretrained SentenceTransformer: sentence-transformers/all-MiniLM-L6-v2
[2025-03-20 22:37:47,009] INFO chromadb_retriever:26 - Initialized ChromaDBRetriever: embedding_model_name: sentence-transformers/all-MiniLM-L6-v2, collection_name: collections, score_threshold: 0.5
[2025-03-20 22:37:47,013] INFO rag_query_processor:25 - Initialized RAGQueryProcessor: use_rag: True
[2025-03-20 22:37:47,021] INFO SentenceTransformer:210 - Use pytorch device_name: mps
[2025-03-20 22:37:47,021] INFO SentenceTransformer:218 - Load pretrained SentenceTransformer: sentence-transformers/all-MiniLM-L6-v2
[2025-03-20 22:37:47,611] INFO posthog:22 - Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
[2025-03-20 22:37:48,071] DEBUG rag_query_processor:51 - Received query: Compare the rights in USA Constitution vs. Norway Constitution. Use only the provided context and don't use any outside material at all. Also, dont give me all the steps, just give me one long paragraph.
[2025-03-20 22:37:48,071] INFO rag_query_processor:54 - --------------------------------------------------------------------------------
[2025-03-20 22:37:48,071] INFO rag_query_processor:55 - Using RAG pipeline...
[2025-03-20 22:37:48,276] WARNING local_persistent_hnsw:423 - Number of requested results 10 is greater than number of elements in index 4, updating n_results = 4
[2025-03-20 22:37:48,287] INFO rag_query_processor:65 - --------------------------------------------------------------------------------
[2025-03-20 22:37:48,287] DEBUG rag_query_processor:69 - Prompt to LLM: Context:
title : the constitution of the united states summary : the united states constitution, ratified in 1787, is the foundational legal document of the u. s. government, establishing its framework, guiding principles, and separation of powers among its branches. it begins with the preamble, which articu
title : norway ’ s constitution of 1814 ( revised 2015 ) summary : norway ’ s constitution of 1814, one of the oldest in the world still in operation, establishes the country as a limited and hereditary monarchy with a parliamentary system. it ensures democracy, rule of law, and human rights, while 

User Query:
Compare the rights in USA Constitution vs. Norway Constitution. Use only the provided context and don't use any outside material at all. Also, dont give me all the steps, just give me one long paragraph.

Please provide a detailed answer in one long paragraph, using only the provided context and without using any outside material.
[2025-03-20 22:37:48,304] DEBUG _base_client:453 - Request options: {'method': 'post', 'url': '/completions', 'files': None, 'json_data': {'model': 'gpt-3.5-turbo-instruct', 'prompt': ["Context: \n\nQuestion: Compare the rights in USA Constitution vs. Norway Constitution. Use only the provided context and don't use any outside material at all. Also, dont give me all the steps, just give me one long paragraph.\n\nAnswer:"], 'frequency_penalty': 0.0, 'logit_bias': {}, 'max_tokens': 256, 'n': 1, 'presence_penalty': 0.0, 'temperature': 0.7, 'top_p': 1.0}}
[2025-03-20 22:37:48,341] DEBUG _base_client:952 - Sending HTTP Request: POST https://api.openai.com/v1/completions
[2025-03-20 22:37:48,341] DEBUG _trace:47 - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
[2025-03-20 22:37:48,403] DEBUG _trace:47 - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x151c59be0>
[2025-03-20 22:37:48,403] DEBUG _trace:47 - start_tls.started ssl_context=<ssl.SSLContext object at 0x151c28440> server_hostname='api.openai.com' timeout=None
[2025-03-20 22:37:48,439] DEBUG _trace:47 - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x151b91e50>
[2025-03-20 22:37:48,440] DEBUG _trace:47 - send_request_headers.started request=<Request [b'POST']>
[2025-03-20 22:37:48,440] DEBUG _trace:47 - send_request_headers.complete
[2025-03-20 22:37:48,440] DEBUG _trace:47 - send_request_body.started request=<Request [b'POST']>
[2025-03-20 22:37:48,440] DEBUG _trace:47 - send_request_body.complete
[2025-03-20 22:37:48,440] DEBUG _trace:47 - receive_response_headers.started request=<Request [b'POST']>
[2025-03-20 22:37:49,096] DEBUG _trace:47 - receive_response_headers.complete return_value=(b'HTTP/1.1', 429, b'Too Many Requests', [(b'Date', b'Fri, 21 Mar 2025 02:37:49 GMT'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Content-Length', b'337'), (b'Connection', b'keep-alive'), (b'vary', b'Origin'), (b'x-request-id', b'req_1eef5e6868f471ab3bcd590adcad9abf'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=cyFzl7hCeDJBuc.zgT_sx5u5H3oh6ySNmDaOxUa3qDw-1742524669-1.0.1.1-99Lb_zu.QbjzA__nO1BN_SjMvSofl_Q3.itkhIGI_.4nQaFPFwfzN6B.1UzdivxpeFjf2b6KLHFlEnaV0XqpFjjniCHK76o2Sb8Nupg.b0U; path=/; expires=Fri, 21-Mar-25 03:07:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=lvKPi4hejxgJkgIvJWsHfEeQXYjj3iI3bhYD3wFHjIE-1742524669075-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'923a11c9cd280f41-EWR'), (b'alt-svc', b'h3=":443"; ma=86400')])
[2025-03-20 22:37:49,098] INFO _client:1025 - HTTP Request: POST https://api.openai.com/v1/completions "HTTP/1.1 429 Too Many Requests"
[2025-03-20 22:37:49,098] DEBUG _trace:47 - receive_response_body.started request=<Request [b'POST']>
[2025-03-20 22:37:49,098] DEBUG _trace:47 - receive_response_body.complete
[2025-03-20 22:37:49,098] DEBUG _trace:47 - response_closed.started
[2025-03-20 22:37:49,098] DEBUG _trace:47 - response_closed.complete
[2025-03-20 22:37:49,099] DEBUG _base_client:991 - HTTP Response: POST https://api.openai.com/v1/completions "429 Too Many Requests" Headers([('date', 'Fri, 21 Mar 2025 02:37:49 GMT'), ('content-type', 'application/json; charset=utf-8'), ('content-length', '337'), ('connection', 'keep-alive'), ('vary', 'Origin'), ('x-request-id', 'req_1eef5e6868f471ab3bcd590adcad9abf'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=cyFzl7hCeDJBuc.zgT_sx5u5H3oh6ySNmDaOxUa3qDw-1742524669-1.0.1.1-99Lb_zu.QbjzA__nO1BN_SjMvSofl_Q3.itkhIGI_.4nQaFPFwfzN6B.1UzdivxpeFjf2b6KLHFlEnaV0XqpFjjniCHK76o2Sb8Nupg.b0U; path=/; expires=Fri, 21-Mar-25 03:07:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=lvKPi4hejxgJkgIvJWsHfEeQXYjj3iI3bhYD3wFHjIE-1742524669075-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '923a11c9cd280f41-EWR'), ('alt-svc', 'h3=":443"; ma=86400')])
[2025-03-20 22:37:49,099] DEBUG _base_client:999 - request_id: req_1eef5e6868f471ab3bcd590adcad9abf
[2025-03-20 22:37:49,099] DEBUG _base_client:1004 - Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/openai/_base_client.py", line 1002, in _request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
[2025-03-20 22:37:49,103] DEBUG _base_client:735 - Retrying due to status code 429
[2025-03-20 22:37:49,103] DEBUG _base_client:1048 - 2 retries left
[2025-03-20 22:37:49,103] INFO _base_client:1051 - Retrying request to /completions in 0.483543 seconds
[2025-03-20 22:37:49,588] DEBUG _base_client:453 - Request options: {'method': 'post', 'url': '/completions', 'files': None, 'json_data': {'model': 'gpt-3.5-turbo-instruct', 'prompt': ["Context: \n\nQuestion: Compare the rights in USA Constitution vs. Norway Constitution. Use only the provided context and don't use any outside material at all. Also, dont give me all the steps, just give me one long paragraph.\n\nAnswer:"], 'frequency_penalty': 0.0, 'logit_bias': {}, 'max_tokens': 256, 'n': 1, 'presence_penalty': 0.0, 'temperature': 0.7, 'top_p': 1.0}}
[2025-03-20 22:37:49,590] DEBUG _base_client:952 - Sending HTTP Request: POST https://api.openai.com/v1/completions
[2025-03-20 22:37:49,590] DEBUG _trace:47 - send_request_headers.started request=<Request [b'POST']>
[2025-03-20 22:37:49,591] DEBUG _trace:47 - send_request_headers.complete
[2025-03-20 22:37:49,591] DEBUG _trace:47 - send_request_body.started request=<Request [b'POST']>
[2025-03-20 22:37:49,591] DEBUG _trace:47 - send_request_body.complete
[2025-03-20 22:37:49,591] DEBUG _trace:47 - receive_response_headers.started request=<Request [b'POST']>
[2025-03-20 22:37:50,079] DEBUG _trace:47 - receive_response_headers.complete return_value=(b'HTTP/1.1', 429, b'Too Many Requests', [(b'Date', b'Fri, 21 Mar 2025 02:37:50 GMT'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Content-Length', b'337'), (b'Connection', b'keep-alive'), (b'vary', b'Origin'), (b'x-request-id', b'req_38c72fa3f9d18511da14bc0c1563c541'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'923a11d0fa2f0f41-EWR'), (b'alt-svc', b'h3=":443"; ma=86400')])
[2025-03-20 22:37:50,079] INFO _client:1025 - HTTP Request: POST https://api.openai.com/v1/completions "HTTP/1.1 429 Too Many Requests"
[2025-03-20 22:37:50,079] DEBUG _trace:47 - receive_response_body.started request=<Request [b'POST']>
[2025-03-20 22:37:50,079] DEBUG _trace:47 - receive_response_body.complete
[2025-03-20 22:37:50,079] DEBUG _trace:47 - response_closed.started
[2025-03-20 22:37:50,079] DEBUG _trace:47 - response_closed.complete
[2025-03-20 22:37:50,080] DEBUG _base_client:991 - HTTP Response: POST https://api.openai.com/v1/completions "429 Too Many Requests" Headers({'date': 'Fri, 21 Mar 2025 02:37:50 GMT', 'content-type': 'application/json; charset=utf-8', 'content-length': '337', 'connection': 'keep-alive', 'vary': 'Origin', 'x-request-id': 'req_38c72fa3f9d18511da14bc0c1563c541', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '923a11d0fa2f0f41-EWR', 'alt-svc': 'h3=":443"; ma=86400'})
[2025-03-20 22:37:50,080] DEBUG _base_client:999 - request_id: req_38c72fa3f9d18511da14bc0c1563c541
[2025-03-20 22:37:50,080] DEBUG _base_client:1004 - Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/openai/_base_client.py", line 1002, in _request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/openai/_base_client.py", line 1002, in _request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
[2025-03-20 22:37:50,081] DEBUG _base_client:735 - Retrying due to status code 429
[2025-03-20 22:37:50,081] DEBUG _base_client:1046 - 1 retry left
[2025-03-20 22:37:50,081] INFO _base_client:1051 - Retrying request to /completions in 0.755817 seconds
[2025-03-20 22:37:50,842] DEBUG _base_client:453 - Request options: {'method': 'post', 'url': '/completions', 'files': None, 'json_data': {'model': 'gpt-3.5-turbo-instruct', 'prompt': ["Context: \n\nQuestion: Compare the rights in USA Constitution vs. Norway Constitution. Use only the provided context and don't use any outside material at all. Also, dont give me all the steps, just give me one long paragraph.\n\nAnswer:"], 'frequency_penalty': 0.0, 'logit_bias': {}, 'max_tokens': 256, 'n': 1, 'presence_penalty': 0.0, 'temperature': 0.7, 'top_p': 1.0}}
[2025-03-20 22:37:50,844] DEBUG _base_client:952 - Sending HTTP Request: POST https://api.openai.com/v1/completions
[2025-03-20 22:37:50,846] DEBUG _trace:47 - send_request_headers.started request=<Request [b'POST']>
[2025-03-20 22:37:50,846] DEBUG _trace:47 - send_request_headers.complete
[2025-03-20 22:37:50,846] DEBUG _trace:47 - send_request_body.started request=<Request [b'POST']>
[2025-03-20 22:37:50,846] DEBUG _trace:47 - send_request_body.complete
[2025-03-20 22:37:50,846] DEBUG _trace:47 - receive_response_headers.started request=<Request [b'POST']>
[2025-03-20 22:37:51,579] DEBUG _trace:47 - receive_response_headers.complete return_value=(b'HTTP/1.1', 429, b'Too Many Requests', [(b'Date', b'Fri, 21 Mar 2025 02:37:51 GMT'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Content-Length', b'337'), (b'Connection', b'keep-alive'), (b'vary', b'Origin'), (b'x-request-id', b'req_acaf88ead46a8d6333a6a5118590157b'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'923a11d8c8fd0f41-EWR'), (b'alt-svc', b'h3=":443"; ma=86400')])
[2025-03-20 22:37:51,579] INFO _client:1025 - HTTP Request: POST https://api.openai.com/v1/completions "HTTP/1.1 429 Too Many Requests"
[2025-03-20 22:37:51,579] DEBUG _trace:47 - receive_response_body.started request=<Request [b'POST']>
[2025-03-20 22:37:51,580] DEBUG _trace:47 - receive_response_body.complete
[2025-03-20 22:37:51,580] DEBUG _trace:47 - response_closed.started
[2025-03-20 22:37:51,580] DEBUG _trace:47 - response_closed.complete
[2025-03-20 22:37:51,580] DEBUG _base_client:991 - HTTP Response: POST https://api.openai.com/v1/completions "429 Too Many Requests" Headers({'date': 'Fri, 21 Mar 2025 02:37:51 GMT', 'content-type': 'application/json; charset=utf-8', 'content-length': '337', 'connection': 'keep-alive', 'vary': 'Origin', 'x-request-id': 'req_acaf88ead46a8d6333a6a5118590157b', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '923a11d8c8fd0f41-EWR', 'alt-svc': 'h3=":443"; ma=86400'})
[2025-03-20 22:37:51,580] DEBUG _base_client:999 - request_id: req_acaf88ead46a8d6333a6a5118590157b
[2025-03-20 22:37:51,580] DEBUG _base_client:1004 - Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/openai/_base_client.py", line 1002, in _request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/openai/_base_client.py", line 1002, in _request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/openai/_base_client.py", line 1002, in _request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
[2025-03-20 22:37:51,581] DEBUG _base_client:1022 - Re-raising status error
[2025-03-20 22:37:51,591] ERROR rag_query_processor:79 - Error processing query: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
[2025-03-20 22:37:51,591] INFO main:150 - [Step 05] Response generation completed.
[2025-03-20 22:37:51,592] INFO main:213 - RAG pipeline done
[2025-03-20 22:37:51,891] DEBUG _trace:47 - close.started
[2025-03-20 22:37:51,892] DEBUG _trace:47 - close.complete
